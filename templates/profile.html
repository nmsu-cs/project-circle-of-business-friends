<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Profile Creation</title>
    <style>
        .error {
            color: red;
        }
    </style>
</head>
<body>
    <div align="center">
        <div align="center" class="border">
            <div class="header">
                <h1 class="word">Profile</h1>
            </div>
            <br><br><br><br><br>
            <h2 class="word">
                {% with messages = get_flashed_messages() %}
                    {% if messages %}
                        <ul>
                            {% for message in messages %}
                                <li class="error">{{ message }}</li>
                            {% endfor %}
                        </ul>
                    {% endif %}
                {% endwith %}
                <form action="{{ url_for('profile.profile') }}" method="post">
                    <label for="age">Age:</label>
                    <input type="text" id="age" name="age" value="{{user.age}}"><br><br>
                    
                    <label for="gender">Gender:</label>
                    <input type="text" id="gender" name="gender" value="{{user.gender}}"><br><br>
                    
                    <label for="interest">Interests:</label>
                    <input type="text" id="search" onkeyup="filterInterests()" placeholder="Search interests...">
                    <select id="interest" name="interest" size="5" style="width: 200px;">
                        {% for i in interests %}
                            <option value="{{i}}">{{i.capitalize()}}</option>
                        {% endfor %}
                    </select><br><br>
                    
                    <!-- Display selected interests -->
                    <p id="selected_interests_list"></p><br><br>

                    <!-- Hidden input field to store selected interests -->
                    <input type="hidden" id="selected_interests" name="selected_interests">

                    <label for="occupation">Occupation:</label>
                    <input type="text" id="occupation" name="occupation" value="{{user.occupation}}"><br><br>
                    
                    <label for="education_level">Education Level:</label>
                    <input type="text" id="education_level" name="education_level" value="{{user.education_level}}"><br><br>
                    
                    <label for="major">Major:</label>
                    <input type="text" id="major" name="major" value="{{user.major}}"><br><br>
                    
                    <input type="submit" class="btn" value="Save">
                </form>
            </h2>
        </div>
    </div>
    <script>
        //function to add search functionality to field input
        //NOTE: Only set to interests for now
        function filterInterests() 
        {
            var input, filter, select, option, i;
            input = document.getElementById("search"); //get input value
            filter = input.value.toUpperCase(); //convert to uppercase
            select = document.getElementById("interest"); //select option from dropdown
            options = select.getElementsByTagName("option"); //get all options from dropdown
            for (i = 0; i < options.length; i++) //iterates through dropdown options
            {
                if (options[i].innerHTML.toUpperCase().indexOf(filter) > -1) //if option is found, display
                {
                    options[i].style.display = "";
                } else {
                    options[i].style.display = "none"; //if option not found, do not display
                }
            }
        }
    
        //"Function"/Event listener to add interest to a string to be passed to flask and to be displayed
        var selectedInterests = []
        document.getElementById("interest").addEventListener("change", function(event) 
        {
            var selectedOption = event.target.value; //get value of selected option

            var index = selectedInterests.indexOf(selectedOption); //find index of selected option in array
            if(index !== -1)
            {
                selectedInterests.splice(index, 1); //if option found, remove
            }
            else
            {
                selectedInterests.push(selectedOption); //if option not found, insert
            }


            //update hidden field to values of selected interests to return
            var selectedInterestsHiddenField = document.getElementById("selected_interests");
            selectedInterestsHiddenField.value = selectedInterests.join(",");

            //update content in the <p> element to display array contents
            var selectedInterestsList = document.getElementById("selected_interests_list");
            selectedInterestsList.innerHTML = selectedInterests.join(",");
        });
        
    </script>
</body>
</html>